<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <title>HardwareLife</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="../../css/styleFuncionario.css">
    <script src="../../js/sessao.js"></script>
</head>

<!-- <body> -->

<body onload=" validarSessao(), listar()">

    <div class="navbar" id="navbar">
        <div class="container_sidebar">
            <span id="side-bar-deactive">X</span>
            <div class="logo">
                <img src="../../assets/index/logo.svg" alt="Logo HardwareLife">
                <h1>HardwareLife</h1>
            </div>
        </div>
        <div class="sidebar">
            <!-- <div class='perfil'>
                    <div class="img_perfil"><img src="../../src/perfil/amazon.jfif" alt="profile"></div>
                    <span>Amazon.com, Inc</span>
                </div> -->
            <div class="link_part">
                <span class="link" style="display: none;">
                    <img src="../../assets/dashboard/icon_config.svg" alt="configurações">
                    <a href="">Perfil</a>
                </span>
                <span class="link">
                    <img src="../../assets/dashboard/door.svg" alt="dashboard">
                    <a href="../dashboard.html">Salas</a>
                </span>
                <!-- <span class="link">
                        <img src="../../assets/dashboard/icon_dashboard.svg" alt="dashboard">
                        <a href="../dashboard.html">Dashboard</a>
                    </span> -->
                <span class="link">
                    <img src="../../assets/dashboard/icon_logout.svg" alt="logo">
                    <a href="../../loginCadastro.html">Sair</a>
                </span>

            </div>
        </div>
        <!-- <a onclick="aparecerModal()" style="margin-left: 20px; cursor: pointer;">Alerta</a> -->
    </div>
    <div class="header">
        <div class="container">
            <div class="side-bar" id="side-bar-active">
                <i class="fa fa-align-justify"></i>
                <div class="logo" id="container">
                    <img src="../../assets/dashboard/logo.svg" alt="Logo HardwareLife">
                    <h1>HardwareLife</h1>
                </div>
            </div>

            <div class="usuario_perfil">
                <h1>Olá,<span id="nome_usuario"></span></h1>
            </div>
        </div>
    </div>
    <div class="container2">
        <article class="card">
            <div class='background'>
                <img src="../../assets/perfil/amazon.jfif" alt="profile">
            </div>
            <div class='content'>
                <h2 id="nome_empresa"></h2>

                <div class="resum">
                    <h3>Informações:</h3>
                    <span><img src="../../assets/perfil/globo.svg" alt="icone">Brasil</span>
                    <span><img src="../../assets/perfil/location.svg" alt="icone">Jundiai - São Paulo</span>
                    <span><img src="../../assets/perfil/phone.svg" alt="icone">(11) 4296-2589</span>
                    <span><img src="../../assets/perfil/emai.svg" alt="icone">amazon@hardwarelife.com</span>
                    <!-- <button class="button_perfil" onclick="mudarCard()" id="botao_perfil">Editar Perfil</button>
                    <button class="button_perfil" onclick="voltarCard()" id="botao_voltar"
                        style="display: none;">Voltar</button> -->
                </div>

            </div>
        </article>
        <article class="card-secund" id="card_secund">
            <form action="" class="formulario_cadastro" onsubmit="return false">
                <span class="titulo_cadastro" id="titulo_cadastro">Cadastrar Novo Funcionário:</span>
                <span class="campos_cadastros" id="campos_cadastros">
                    <div class="campo">
                        <label for="nome_funcionario">Nome:</label>
                        <input type="text" id="nome_funcionario" placeholder="Nome Funcionario" onblur="validarNome(this)">
                        <span id="nomeInvalido" style="display: none;">O nome precisa ter no mínimo 3 letras</span>
                    </div>
                    <div class="campo">
                        <label for="nome_funcionario">Sobrenome:</label>
                        <input type="text" id="sobrenome_funcionario" placeholder="Sobrenome Funcionario" onblur="validarSobrenome(this)">
                        <span id="sobrenomeInvalido" style="display: none;">O sobrenome precisa ter no mínimo 3 letras</span>
                    </div>
                    <div class="campo">
                        <label for="nome_funcionario">CPF:</label>
                        <input type="text" id="cpf_funcionario" placeholder="Cpf Funcionario" onblur="validarCpf(this)">
                        <span id="cpfInvalido" style="display: none;">O cpf deve ter apenas 11 digitos e todos devem ser numéricos</span>
                    </div>
                    <div class="campo">
                        <label for="nome_funcionario">Email:</label>
                        <input type="email" id="email_funcionario" placeholder="Email Funcionario" onblur="validarEmail(this)">
                        <span id="emailInvalido" style="display: none;">Email com formato inválido</span>
                    </div>
                    <div class="campo">
                        <label for="nome_funcionario">Senha:</label>
                        <input type="password" id="senha_funcionario" placeholder="Senha Funcionario" onblur="validarSenha(this)">
                        <span id="senhaInvalida" style="display: none;"></span>
                    </div><br><br>
                    <div class="campo">
                        <label for="confirmarSenha_funcionario">Confime sua senha:</label>
                        <input type="password" id="confirmarSenha_funcionario" placeholder="Confirme sua senha" onblur="confirmarSenha(this)">
                        <span id="confirmarSenha_func" style="display: none;">As senhas não estão iguais</span>
                    </div>
                    <div class="campo">
                        <label for="cargo_funcionario">Cargo</label>
                        <select name="cargo_funcionario" id="cargo_funcionario">
                        </select>
                    </div>
                    <!-- <div class="campo" id="campo_unidade">
                        <label for="unidade">Unidade:</label>
                        <select name="escolha_unidade" id="escolha_unidade">
                            <option value="0"></option>
                            <option value="1">Jundiai</option>
                            <option value="2">Campo</option>
                        </select>
                    </div> -->
                </span>
                <button class="btn_form_cadastro" onclick="cadastrar()">Cadastrar</button>
            </form>
            
            <div class="lista_funcionario" id="lista">
                <div class="legendas">
                    <p>Nome</p>
                    <p>Email</p>
                    <p>Nível</p>
                </div>
            </div>

        </article>

        <!-- <article class="card-secund" id="card_endereco" style="display: none;">
            <form action="" class="formulario_cadastro cadastro_perfil">
                <span class="titulo_cadastro" id="titulo_cadastro">Cadastrar Informações do Perfil:</span>
                <span class="campos_cadastros" id="campos_cadastros">
                    <div class="campo">
                        <label for="nome_usuario">Nome:</label>
                        <input type="text" id="nome_usuario" placeholder="Nome">
                    </div>
                    <div class="campo">
                        <label for="sobrenome_usuario">Sobrenome:</label>
                        <input type="text" id="sobrenome_usuario" placeholder="Sobrenome">
                    </div>
                    <div class="campo">
                        <label for="cpf_usuario">CPF:</label>
                        <input type="text" id="cpf_usuario" placeholder="Cpf">
                    </div>
                    <div class="campo">
                        <label for="email_usuario">Email:</label>
                        <input type="email" id="email_usuario" placeholder="Email">
                    </div>
                    <div class="campo">
                        <label for="senha_usuario">Senha:</label>
                        <input type="password" id="senha_usuario" placeholder="Senha">
                    </div>
                    <div class="campo" id="campo_razao">
                        <label for="razaoSocial">Razão Social da Empresa:</label>
                        <input type="text" id="razaoSocial_empresa" placeholder="Razão Social da Empresa">
                    </div>
                    <button class="btn_form_cadastro" onclick="editarPerfil()">Cadastrar</button>
                </span>

            </form>
            <div class="formulario_cadastro" style="padding-top: 0; ">
                <span class="titulo_cadastro" id="titulo_cadastro">Cadastrar Informações de Endereço:</span>
                <span class="campos_cadastros" id="campos_cadastros">
                    <div class="campo">
                        <label for="logradouro">Rua:</label>
                        <input type="text" id="rua_datacenter" placeholder="Rua">
                    </div>
                    <div class="campo">
                        <label for="numero_usuario">Número:</label>
                        <input type="text" id="numero_usuario" placeholder="número">
                    </div>
                    <div class="campo">
                        <label for="bairro_usuario">Bairro:</label>
                        <input type="text" id="bairro_usuario" placeholder="Bairro">
                    </div>
                    <div class="campo">
                        <label for="cidade_usuario">Cidade:</label>
                        <input type="text" id="cidade_usuario" placeholder="Cidade">
                    </div>
                    <div class="campo">
                        <label for="uf_usuario">UF:</label>
                        <input type="text" id="uf_usuario" placeholder="UF">
                    </div>
                    <div class="campo" id="campo_razao">
                        <label for="cep">CEP:</label>
                        <input type="text" id="cep_empresa" placeholder="Cep">
                    </div>
                    <button class="btn_form_cadastro" onclick="cadastrarEndereco()">Cadastrar</button>
                </span>
            </div>

        </article> -->
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    var idUsuario = sessionStorage.ID_USUARIO;
    nome_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    nome_empresa.innerHTML = sessionStorage.NOME_EMPRESA;
    var nivel = sessionStorage.TIPO_NIVEL;
    var informacaoSala = JSON.parse(sessionStorage.SALAS);
    var funcionarioDataCenter = []

    var activeSideBar = document.getElementById("side-bar-active");
    var deactiveSideBar = document.getElementById("side-bar-deactive");

    activeSideBar.addEventListener("click", function () {
        navbar.style.display = "flex";
        container.style.visibility = "hidden";
    })

    deactiveSideBar.addEventListener("click", function () {
        navbar.style.display = "none";
        container.style.visibility = "visible";
    });

    const cadastroInvalido = () =>{
        Swal.fire({
        icon: "error",
        title: "Cadastro não funcionou",
        text: "Verifique se os campos foram preenchidos corretamente",
        confirmButtonColor: "#11128D"
    });
    }

    const cadastroValido = () => {
        Swal.fire({
        title: "Cadastro Realizado com Sucesso",    
        icon: "success",
        confirmButtonColor: "#11128D"
    }).then(() => window.location = `/dashboard/perfil/funcionario.html`);
    }

    const mensagemDeletar = () => {
        Swal.fire({
        title: "Funcionário Deletado com Sucesso",    
        icon: "success",
        confirmButtonColor: "#11128D"
    }).then(() => window.location = `/dashboard/perfil/funcionario.html`);
    }


    function listar() {
        var idDatacenter = informacaoSala[0].fkDatacenter;

        fetch(`/usuarios/listar/${idDatacenter}`)
        .then(function (resultado) {
            if(resultado.ok){
                resultado.json().then(json => {
                    console.log(json)
                    funcionarioDataCenter = json
                })
            }
        }).catch(function (resultado) {
            
        });
    }

    setTimeout(() => {

        cargo_funcionario.innerHTML = ""

        if(nivel == "CEO"){
            cargo_funcionario.innerHTML += `<option value="Gestor">Gestor</option>`
            cargo_funcionario.innerHTML += `<option value="Funcionario">Funcionário</option>`;
            var mostrarFuncionario = funcionarioDataCenter.filter(func => func.tipoNivel != nivel)
        }else if(nivel == "Gestor"){
            cargo_funcionario.innerHTML += `<option value="Funcionario">Funcionário</option>`
            var mostrarFuncionario = funcionarioDataCenter.filter(func => func.tipoNivel != nivel && func.tipoNivel != "CEO")
        }

        for(var i = 0; i < mostrarFuncionario.length; i++){

                lista.innerHTML += `
            <div class="lista_item">
                    <div class="item_nome">${mostrarFuncionario[i].nome}</div>
                    <div class="item_nome">${mostrarFuncionario[i].email}</div>
                    <div class="item_nome">${mostrarFuncionario[i].tipoNivel}</div>
                    <span class="material-symbols-outlined delete" style="margin-left: -10%; cursor: pointer;" onclick="deletarFuncionario(this)" value="${mostrarFuncionario[i].idFuncionario}">delete</span>
                </div>`;
        }

    }, 500)

    const deletarFuncionario = (funcionario) => {

        var idFuncionario = funcionario.getAttribute("value")

        fetch(`/usuarios/deletar/${idFuncionario}`, {
            headers: {
                "Content-Type": "application/json"
            },
            method: "DELETE",
            cache: 'no-store'
        }).then(resposta => {
            if(resposta.ok){
                mensagemDeletar()
            }
        })

        }

    // function validarNivel() {
    //     if (nivel == "CEO") {
    //         campo_unidade.style.display = "flex";
    //     }else {
    //         card_secund.innerHTML += "Q MENTIRA"
    //     }
    // }

    var nomeValido = false
    var sobrenomeValido = false
    var emailValido = false
    var cpfValido = false
    var senhaValida = false
    var confirmarSenhaValida = false

    function validarNome(nomeFunc){
            if(nomeFunc.value.length >= 1 && nomeFunc.value.length < 3){
                nomeInvalido.style.display = `block`
                nomeInvalido.style.color = `red` 
                nome_funcionario.style.borderColor = `red`
                nome_funcionario.style.color = `red`
                nomeValido = false
            }else if(nomeFunc.value.length == 0){
                nomeInvalido.style.display = `none`
                nome_funcionario.style.borderColor = `black`
                nome_funcionario.style.color = `black`
                nomeValido == false
            }else{
                nomeInvalido.style.display = `none`
                nome_funcionario.style.borderColor = `black`
                nome_funcionario.style.color = `black`
                nomeValido = true
            }
    }
    function validarSobrenome(sobrenome){
        if(sobrenome.value.length >= 1 && sobrenome.value.length < 3){
            sobrenomeInvalido.style.display = `block`
            sobrenomeInvalido.style.color = `red`
            sobrenome_funcionario.style.borderColor = `red`
            sobrenome_funcionario.style.color = `red` 
            sobrenomeValido = false
        }else if(sobrenome.value.length == 0){
            sobrenomeInvalido.style.display = `none`;
            sobrenome_funcionario.style.borderColor = `black`;
            sobrenome_funcionario.style.color = `black`;
            sobrenomeValido = false
        }else{
            sobrenomeInvalido.style.display = `none`;
            sobrenome_funcionario.style.borderColor = `black`;
            sobrenome_funcionario.style.color = `black`;
            sobrenomeValido = true
        }
    }

    const hasUpper = (str) => /[A-Z]/.test(str)

    const validarEmail = (emailUser) => {

    if(emailUser.value.length >= 1 && (!emailUser.value.includes("@") || !emailUser.value.includes("."))){
      email_funcionario.style.border = `1px solid red`;
      email_funcionario.style.color = `red`;
      emailInvalido.style.display = `block`;
      emailInvalido.style.color = `red`
      emailValido = false
    }else if(emailUser.value.length == 0){
      email_funcionario.style.border = `1px solid black`;
      email_funcionario.style.color = `black`;
      emailInvalido.style.display = `none`;
      emailInvalido.style.color = `black`
      emailValido = false
    }else{
        email_funcionario.style.border = `1px solid black`;
        email_funcionario.style.color = `black`;
        emailInvalido.style.display = `none`;
        emailInvalido.style.color = `black`
        emailValido = true
    }

  }

  const validarCpf = (cpf) => {

    if(cpf.value.length >= 1  && cpf.value.length < 11){
        cpf_funcionario.style.borderColor = `red`
        cpf_funcionario.style.color = `red`
        cpfInvalido.style.display = `block`
        cpfInvalido.style.color = `red`
        cpfValido = false
    }else if(cpf.value.length == 0){
        cpf_funcionario.style.borderColor = `black`
        cpf_funcionario.style.color = `black`
        cpfInvalido.style.display = `none`
        cpfValido = false
    }else{
        cpf_funcionario.style.borderColor = `black`
        cpf_funcionario.style.color = `black`
        cpfInvalido.style.display = `none`
        cpfValido = true
    }


  }

  const validarSenha = (senhaUsuario) => {
    if(senhaUsuario.value.length < 6  || !senhaUsuario.value.includes("@", "#", "!", "$", "%", "&", "*") || !hasUpper(senhaUsuario.value)){

      if(senhaUsuario.value.length < 6 && senhaUsuario.value.length >=1 ){
        senha_funcionario.style.border = `1px solid red`
        senha_funcionario.style.color = `red`
        senhaInvalida.style.display = `block`
        senhaInvalida.style.color = `red`
        senhaInvalida.innerHTML = `A senha deve ter mais de 6 caracteres`
        senhaValida = false
      }else if(!senhaUsuario.value.includes("@", "#", "!", "$", "%", "&", "*") && senhaUsuario.value.length >=1){
        senha_funcionario.style.border = `1px solid red`
        senha_funcionario.style.color = `red`
        senhaInvalida.style.display = `block`
        senhaInvalida.style.color = `red`
        senhaInvalida.innerHTML = `A senha precisa ter pelo menos um caracter especial (@, #, &)`
        senhaValida = false
    }else if(!hasUpper(senhaUsuario.value) && senhaUsuario.value.length >=1){
        console.log(senhaUsuario.value)
        senha_funcionario.style.border = `1px solid red`
        senha_funcionario.style.color = `red`
        senhaInvalida.style.display = `block`
        senhaInvalida.style.color = `red`
        senhaInvalida.innerHTML = `A senha precisa ter pelo menos um caracter maiúsculo`
        senhaValida = false
    }else{
        senha_funcionario.style.border = `1px solid black`
        senha_funcionario.style.color= `black`
        senhaInvalida.style.display = `none`
        senhaInvalida.style.color = `black`
        senhaValida = false
    }

    }else{
        senha_funcionario.style.border = `1px solid black`
        senha_funcionario.style.color = `black`
        senhaInvalida.style.display = `none`
        senhaInvalida.style.color = `black`
        senhaValida = true
    }
  }

  function confirmarSenha(confirmarSenha){
    if(confirmarSenha.value != senha_funcionario.value && confirmarSenha.value.length >= 1){
        senha_funcionario.style.border = `1px solid red`
        senha_funcionario.style.color = `red`
        senhaInvalida.style.color = `red`

        confirmarSenha_funcionario.style.border = `1px solid red`
        confirmarSenha_funcionario.style.color = `red`
        confirmarSenha_func.style.display = `block`
        confirmarSenha_func.style.color = `red`
        confirmarSenhaValida = false
      }else if(confirmarSenha.value.length == 0){
          confirmarSenha_funcionario.style.border = `1px solid black`
          confirmarSenha_funcionario.style.color = `black`
          confirmarSenha_func.style.display = `none`
          confirmarSenha_func.style.color = `black`
          confirmarSenhaValida = false
      }else{
        validarSenha(confirmarSenha)
        confirmarSenhaValida = true
        confirmarSenha_funcionario.style.border = `1px solid black`
        confirmarSenha_funcionario.style.color = `black`
        confirmarSenha_func.style.display = `none`
        confirmarSenha_func.style.color = `black`
      }
  }

    function cadastrar() {

        if(nomeValido == false || sobrenomeValido == false || emailValido == false || cpfValido == false || senhaValida == false || confirmarSenhaValida == false){
            cadastroInvalido()
            return false
        }

        var idUsuario = sessionStorage.ID_USUARIO;
        var idDatacenter = informacaoSala[0].fkDatacenter;
        var nomeFunc = nome_funcionario.value;
        var sobrenomeFunc = nome_funcionario.value;
        var cpfFunc = cpf_funcionario.value;
        var emailFunc = email_funcionario.value;
        var senhaFunc = senha_funcionario.value;
        var nivelFunc = cargo_funcionario.value;

        console.log(idDatacenter, informacaoSala)

        if (nomeFunc === "" || sobrenomeFunc === "" || cpfFunc === ""
            || emailFunc === "" || senhaFunc === "") {
            return false;
        } else {
            // setTimeout(() => {
            // meuModal.style.display = "none";
            // }, 6000);
        }

        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                nomeServer: nomeFunc,
                sobrenomeServer: sobrenomeFunc,
                cpfServer: cpfFunc,
                emailServer: emailFunc,
                senhaServer: senhaFunc,
                nivelServer: nivelFunc,
                fkSuperiorServer: idUsuario,
                fkDataCenterServer: idDatacenter

            }),
        })

            .then(function (resposta) {
                console.log("resposta: ", resposta);
                cadastroValido()

                //     if (resposta.ok) {
                //     // meuModal.style.display = "block";

                //     successMessage.style.display = "block";

                //     setTimeout(() => { signin() }, "1000");

                //     // limparFormulario();
                //     // finalizarAguardar();
                // } else {
                //     throw "Houve um erro ao tentar realizar o cadastro!";
                //     // meuModal.style.display = "block";
                //     erroMessage.style.display = "block";
                //     // successMessage.innerHTML = `${json.mensagem}`;
                // }

            })
            .catch(function (resultado) {
                console.log(`#ERRO: ${resultado}`);
            });

        return false;
    }

    // function mudarCard() {
    //     card_secund.style.display = "none";
    //     // card_endereco.style.transition = "2s";
    //     card_endereco.style.display = "flex";
    //     botao_perfil.style.display = "none";
    //     botao_voltar.style.display = "flex";
    // }

    // function voltarCard() {
    //     card_secund.style.display = "flex";
    //     // card_endereco.style.transition = "2s";
    //     card_endereco.style.display = "none";
    //     botao_perfil.style.display = "flex";
    //     botao_voltar.style.display = "none";
    // }


</script>

</html>